## 程序计数器（PC寄存器）

程序计数器（Program Counter Register）中的**Register**，命名源于CPU的寄存器寄存器存储指令相关的现场信息，CPU只有把数据装载到寄存器才能够运行。

**JVM中的PC寄存器是对物理PC寄存器的一种抽象模拟**

### 程序计数器的作用

PC寄存器是用来存储指向下一条指令的地址，也就是即将要执行的指令代码。由执行引擎读取下一条指令。

![截屏2020-06-08下午8.40.57](https://gitee.com/Sunxz007/PicStorage/raw/master/imgs/20200608204439.png)

### 特点

* 它是一块很小的内存空间，几乎可以忽略不计。也是运行速度最快的存储区域

* 在jvm规范中，每个线程都有它自己的程序计数器，它是线程私有的，生命周期与线程的生命周期保持一致
* 任何时间一个线程都只有一个方法在执行，也就是所谓的**当前方法**。程序计数器会存储当前线程正在执行的java方法的JVM指令地址；或者，如果实在执行native方法，则是未指定值（undefined）。
* 它是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成

* 字节码解释器工作时就是通过改变这个计数器的值来选取吓一跳需要执行的字节码指令

**注意：程序计数器是唯一一个不会出现 OutOfMemoryError 的内存区域，它的生命周期随着线程的创建而创建，随着线程的结束而死亡。**

### 代码示例

![截屏2020-06-08下午8.53.21](https://gitee.com/Sunxz007/PicStorage/raw/master/imgs/20200608205339.png)



## 面试题

1. **使用PC寄存器存储字节码指令地址有什么用呢？/ 为什么使用PC寄存器记录当前线程的执行地址呢？** 

> **因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行
> JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令**
>
> ![截屏2020-06-08下午9.01.50](https://gitee.com/Sunxz007/PicStorage/raw/master/imgs/20200608210208.png)



2. **PC寄存器为什么会设定为线程私有**

> 多线程在一个特定的时间段内指回执行其中某一个线程的方法，CPU会不停滴做任务切换，这样必然会导致经常中断或恢复.因此，**为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个PC寄存器,**这样各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况。

**并行与并发**

> 并行：同一时间多个线程同时执行；
> 并发：一个核快速切换多个线程，让它们依次执行，看起来像并行，实际上是并发

